!function(e){e.asuggestKeys={UNKNOWN:0,SHIFT:16,CTRL:17,ALT:18,LEFT:37,UP:38,RIGHT:39,DOWN:40,DEL:46,TAB:9,RETURN:13,ESC:27,COMMA:188,PAGEUP:33,PAGEDOWN:34,BACKSPACE:8,SPACE:32},e.asuggestFocused=null,e.fn.asuggest=function(t,s){return this.each(function(){e.makeSuggest(this,t,s)})},e.fn.asuggest.defaults={delimiters:"\n ",minChunkSize:1,cycleOnTab:!0,autoComplete:!0,endingSymbols:" ",stopSuggestionKeys:[e.asuggestKeys.RETURN]},e.makeSuggest=function(t,s,n){n=e.extend({},e.fn.asuggest.defaults,n);var o=e.asuggestKeys,i=e(t);return i.suggests=s,i.options=n,i.getChunk=function(){var e=this.options.delimiters.split(""),t=this.val().substr(0,this.getSelection().start),s=-1;for(var n in e){var o=e[n],i=t.lastIndexOf(o);i>s&&(s=i)}return s<0?t:t.substr(s+1)},i.getCompletion=function(e){for(var t=this.getChunk(),s=this.getSelection().text,n=this.suggests,o=!1,i=null,a=0;a<n.length;a++){var u=n[a];if(0==u.indexOf(t)){if(!e)return u.substr(t.length);if(t+s==u)o=!0;else{if(o)return u.substr(t.length);null==i&&(i=u)}}}return e&&i?i.substr(t.length):null},i.updateSelection=function(e){if(e){var t=i.getSelection().start,s=t+e.length;""==i.getSelection().text?(i.val().length==t&&i.setCaretPos(t+1e4),i.insertAtCaretPos(e)):i.replaceSelection(e),i.setSelection(t,s)}},i.keydown(function(t){if(t.keyCode==o.TAB&&i.options.cycleOnTab)return i.getChunk().length>=i.options.minChunkSize&&i.updateSelection(i.getCompletion(performCycle=!0)),t.preventDefault(),t.stopPropagation(),i.focus(),e.asuggestFocused=this,!1;if(i.getSelection().length&&-1!=e.inArray(t.keyCode,i.options.stopSuggestionKeys)){var s=i.getSelection().end+i.options.endingSymbols.length,n=i.getSelection().text+i.options.endingSymbols;return i.replaceSelection(n),i.setSelection(s,s),t.preventDefault(),t.stopPropagation(),this.focus(),e.asuggestFocused=this,!1}}),i.keyup(function(e){var t=e.altKey||e.metaKey||e.ctrlKey,s=t||e.shiftKey;switch(e.keyCode){case o.UNKNOWN:case o.SHIFT:case o.CTRL:case o.ALT:case o.RETURN:break;case o.TAB:if(!s&&i.options.cycleOnTab)break;case o.ESC:case o.BACKSPACE:case o.DEL:case o.UP:case o.DOWN:case o.LEFT:case o.RIGHT:!s&&i.options.autoComplete&&i.replaceSelection("");break;default:!t&&i.options.autoComplete&&i.getChunk().length>=i.options.minChunkSize&&i.updateSelection(i.getCompletion(performCycle=!1))}}),i}}(jQuery);